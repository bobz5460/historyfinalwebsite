<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Start at Bottom</title>
  <script>
    history.scrollRestoration = "manual";
    window.addEventListener("DOMContentLoaded", () => {
      window.scrollTo(0, document.body.scrollHeight);
    });
  </script>
	<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/ScrollSmoother.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/TextPlugin.min.js"></script>
	<script src="https://unpkg.com/split-type"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>

<div class="stars-layer layer1"></div>
<div class="stars-layer layer2"></div>
<div class="stars-layer layer3"></div>
<body>
  <style>
    .timeline {
      position: relative;
      margin: 0 auto;
      padding: 0;
      width: 4px;
      background: linear-gradient(to bottom, rgba(50, 70, 150, 0.6), rgba(101, 125, 255, 0.9));
      height: 10000px;
      box-shadow: 0 0 15px rgba(101, 125, 255, 0.4);
    }

    .timeline .fill {
      position: relative;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(to bottom, #cfd9ff, #657dff);
      height: 0;
      transition: height 0.01s linear;
      box-shadow: 0 0 10px rgba(101, 125, 255, 0.8);
    }

    .timeline-dot {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 16px;
      height: 16px;
      background-color: #657dff;
      border: 4px solid rgba(13, 23, 58, 0.8);
      border-radius: 50%;
      bottom: -50%;
      box-shadow: 0 0 10px 2px rgba(101, 125, 255, 0.7);
      z-index: 5;
      transition: all 0.3s ease;
    }

    .timeline-dot:hover {
      transform: translateX(-50%) scale(1.2);
      box-shadow: 0 0 15px 4px rgba(101, 125, 255, 0.9);
    }
  </style>
  <div id="smooth-wrapper">
    <div id="smooth-content">

	<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
	<img src='static/moon.png' class='moon' data-speed="0.8">
    <h1 style="z-index: 5; left: 50%; color: white">You've reached the Moon</h1>
	<div class="timeline" id="timeline">

    <div class="dot-image" style="bottom: 5.7%; opacity:0; visibility:hidden; transform:translateY(-50px);">
      <img src="static/moon.png" >
    </div>
    <div class="timeline-dot" style="bottom: 5.5%;"></div>
    <div class="dot-label" style="bottom: 5%; opacity:0; visibility:hidden; transform:translateY(-50px);">
	    <h1>The Start</h1>
	    <p>At the end of World War II, tensions between the United States and the Soviet Union caused the start of the Cold War. Both superpowers began competing in everything, including science and technology. Rocketry became a key focus as both nations funded programs to advance missile and space programs. In July 1955, the U.S. announced plans to launch an artificial satellite during the International Geophysical Year. The USSR responded four days later with a similar announcement, marking the beginning of the Space Race.</p>
      </p>
    </div>

    <div class="timeline-dot" style="bottom: 20%;"></div>
    <div class="dot-label" style="bottom: 20%; opacity:0; visibility:hidden; transform:translateY(50%);">Event 2</div>

    <div class="timeline-dot" style="bottom: 50%;"></div>
    <div class="dot-label" style="bottom: 50%; opacity:0; visibility:hidden; transform:translateY(50%);">Event 3</div>

    <div class="timeline-dot" style="bottom: 90%;"></div>
    <div class="dot-label" style="bottom: 90%; opacity:0; visibility:hidden; transform:translateY(50%);"></div>

    <div class="fill" id="fillLine"></div>
	  <img src="static/image.png" id="stickyImage" />

</div>

<div class="container">
	    <img src='static/earth.png' class='earth'>
	    <div class="middle"> <h1 id="welcome">Welcome to Space!</h1> </div>
    </div>
    </div>
  </div>

</body>


<script>
	gsap.registerPlugin(ScrollTrigger, ScrollSmoother, TextPlugin, SplitType);
    ScrollSmoother.create({
  smooth: 1,
  effects: true,
  smoothTouch: 0.1,
});
    gsap.registerEffect({
  name: "fade",
  effect: (targets, config) => {
    return gsap.to(targets, { duration: config.duration, opacity: 100 });
  },
  defaults: { duration: 1 },
  extendTimeline: true,
});
	const welcome = new SplitType("#welcome");
	gsap.to('.char', {
		y: 0,
		stagger: 0.02,
		delay: 0.5,
		duration: 0.6,
		ease: "circ.out"
	})
	gsap.to(".layer1", {
	  backgroundPositionY: "-=2000px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
    gsap.to(".layer2", {
	  backgroundPositionY: "-=1200px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
    gsap.to(".layer3", {
	  backgroundPositionY: "-=800px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
	gsap.to(".earth", {
	  backgroundPositionY: "-=10000x",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});

  document.addEventListener("DOMContentLoaded", () => {
    // Ensure all dot-labels and dot-images are hidden before animation
    gsap.set(document.querySelectorAll('.dot-label, .dot-image'), {
      autoAlpha: 0,
      y: -50
    });

    let smoother;
    let timelineHeight;
    let fillLine = document.getElementById("fillLine");
    let stickyImage = document.getElementById("stickyImage");

    stickyImage.style.position = "absolute";
    stickyImage.style.bottom = "0"; 
    stickyImage.style.transform = "translateY(50%)"; 
    
    const rocketTimeline = gsap.timeline({
      paused: true,
      defaults: {
        ease: "power1.inOut"
      }
    });
    rocketTimeline.to(stickyImage, {
      rotation: 5,
      duration: 0.01
    }).to(stickyImage, {
      rotation: -5,
      duration: 0.01
    }).to(stickyImage, {
      rotation: 0,
      duration: 0.01
    });

    const setupScrollTrigger = () => {
      if (!smoother) {
        setTimeout(setupScrollTrigger, 100);
        return;
      }

      const timeline = document.getElementById("timeline");
      timelineHeight = timeline.offsetHeight;
      fillLine.style.position = "absolute";
      fillLine.style.bottom = "0";
      fillLine.style.height = "100%"; 

      ScrollTrigger.create({
        trigger: "#timeline",
        start: "top bottom", 
        end: "bottom top",
        onUpdate: self => {
          
          const timelineRect = timeline.getBoundingClientRect();
          const viewportHeight = window.innerHeight;
          const timelineTop = timelineRect.top;
          const timelineBottom = timelineRect.bottom;
          const timelineHeight = timelineRect.height;

          
          let progress;
          if (timelineBottom <= 0) {
            progress = 0;
          } else if (timelineTop >= viewportHeight) {
            progress = 1;
          } else {
            // Correct progress: 1 at bottom, 0 at top
            progress = (timelineBottom - viewportHeight) / (timelineHeight - viewportHeight);
            progress = Math.max(0, Math.min(1, progress));
          }
          // Set fill height (starts at 100%, shrinks to 0%)
          fillLine.style.height = (progress * 100) + "%";
          // Move rocket accordingly (optional, keep as before)
          const rocketBottom = progress * timelineHeight;
          gsap.to(stickyImage, {
            bottom: rocketBottom + "px",
            duration: 0.1,
            overwrite: "auto"
          });

          if (Math.abs(self.getVelocity()) > 0) {
            const intensity = Math.min(1, Math.abs(self.getVelocity()) / 1000);
            gsap.to(stickyImage, {
              scale: 1 + (intensity * 0.05),
              duration: 0.2
            });

            if (self.getVelocity() > 0) { 
              gsap.to(stickyImage, { rotation: 180, duration: 0.3 });
            } else {
              gsap.to(stickyImage, { rotation: 0, duration: 0.3 });
            }
          }
        },
        invalidateOnRefresh: true
      });
      
      document.querySelectorAll('.dot-label').forEach(label => {
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: label,
            start: "center bottom",
            end: "center top-=150",
            toggleActions: "play reverse play reverse",
            markers: false
          }
        });

        tl.set(label, {autoAlpha: 0, y: 20})
          .to(label, {
            autoAlpha: 1,
            y: 0,
            duration: 0.8,
            ease: "power3.out"
          })
          .from(label.querySelector('h1'), {
            opacity: 0,
            y: 10,
            duration: 0.5,
            ease: "back.out(1.4)"
          }, "-=0.4")
          .from(label.querySelector('p'), {
            opacity: 0,
            y: 10,
            duration: 0.5,
            ease: "power2.out"
          }, "-=0.3");
      });
      document.querySelectorAll('.dot-image').forEach(label => {
        gsap.to(label, {
          autoAlpha: 1,
          y: 0,
          duration: 1,
          ease: "power2.inOut",
          scrollTrigger: {
            trigger: label,
            start: "center bottom",
            end: "center top-=150",
            toggleActions: "play reverse play reverse",
            markers: false
          }
        });
      });
      // Initialize bottom labels to be visible on page load since we start at the bottom
      setTimeout(() => {
        const viewportHeight = window.innerHeight;
        document.querySelectorAll('.dot-label').forEach(label => {
          const bottom = parseFloat(label.style.bottom) || 0;
          if (bottom <= 20) {
            gsap.set(label, {opacity: 1, y: 0, visibility: 'visible'});
          }
        });
      }, 500);
    };

    const checkSmoother = () => {
      smoother = ScrollSmoother.get();
      if (smoother) {
        setupScrollTrigger();
      } else {
        setTimeout(checkSmoother, 100);
      }
    };
        setTimeout(() => {
    const viewportHeight = window.innerHeight;
    window.scrollTo({
      top: document.documentElement.scrollTop - viewportHeight,
      behavior: 'smooth'
    });
  }, 2000);
    checkSmoother();
  });

</script>