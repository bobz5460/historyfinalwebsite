<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Start at Bottom</title>
  <script>
    history.scrollRestoration = "manual";
    window.addEventListener("DOMContentLoaded", () => {
      window.scrollTo(0, document.body.scrollHeight);
    });
  </script>
	<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/ScrollSmoother.min.js"></script>
	<script src="https://unpkg.com/gsap@3/dist/TextPlugin.min.js"></script>
	<script src="https://unpkg.com/split-type"></script>
</head>

<div class="stars-layer layer1"></div>
<div class="stars-layer layer2"></div>
<div class="stars-layer layer3"></div>
<body>
  <div id="smooth-wrapper">
    <div id="smooth-content">

	<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
	<img src='static/moon.png' class='moon' data-speed="0.8">
    <h1 style="z-index: 5; left: 50%; color: white">You've reached the Moon</h1>
	<div class="timeline" id="timeline">


    <div class="timeline-dot" style="bottom: 5%;"></div>
    <div class="dot-label" style="bottom: 5%;">
	    <h1>The Start</h1>
	    <p>The USSR and US did stuff reg erg erg er
         er gerg ergeijrgo erigj eorij goeijrge
         rpigjerpoigjeporigjeporgjepjrjigergj
         eprij gejpergj
      </p>
    </div>

    <div class="timeline-dot" style="bottom: 20%;"></div>
    <div class="dot-label" style="bottom: 20%;">Event 2</div>

    <div class="timeline-dot" style="bottom: 50%;"></div>
    <div class="dot-label" style="bottom: 50%;">Event 3</div>

    <div class="timeline-dot" style="bottom: 90%;"></div>
    <div class="dot-label" style="bottom: 90%;"></div>
    <div class="dot-image" style="bottom: 5%;">
      <img src="static/moon.png" >
    </div>
    <div class="fill" id="fillLine"></div>
	  <img src="static/image.png" id="stickyImage" />

</div>
	
<div class="container">
	    <img src='static/earth.png' class='earth'>
	    <div class="middle"> <h1 id="welcome" style="font-family: myfont, sans-serif">Welcome to Space!</h1> </div>
    </div>
    </div>
  </div>

</body>


<script>
	gsap.registerPlugin(ScrollTrigger, ScrollSmoother, TextPlugin, SplitType);
    ScrollSmoother.create({
  smooth: 1,
  effects: true,
  smoothTouch: 0.1,
});
    gsap.registerEffect({
  name: "fade",
  effect: (targets, config) => {
    return gsap.to(targets, { duration: config.duration, opacity: 100 });
  },
  defaults: { duration: 1 },
  extendTimeline: true,
});
	const welcome = new SplitType("#welcome");
	gsap.to('.char', {
		y: 0,
		stagger: 0.02,
		delay: 0.5,
		duration: 0.6,
		ease: "circ.out"
	})
	gsap.to(".layer1", {
	  backgroundPositionY: "-=2000px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
    gsap.to(".layer2", {
	  backgroundPositionY: "-=1200px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
    gsap.to(".layer3", {
	  backgroundPositionY: "-=800px",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
	gsap.to(".earth", {
	  backgroundPositionY: "-=10000x",
	  ease: "none",
	  scrollTrigger: {
	    trigger: "body",
	    start: "top top",
	    end: "bottom bottom",
	    scrub: true
	  }
	});
  setTimeout(() => {
    const viewportHeight = window.innerHeight;
    window.scrollTo({
      top: document.documentElement.scrollTop - viewportHeight,
      behavior: 'smooth'
    });
  }, 2000);
  document.addEventListener("DOMContentLoaded", () => {
    let smoother;
    let timelineHeight;
    let fillLine = document.getElementById("fillLine");
    let stickyImage = document.getElementById("stickyImage");

    stickyImage.style.position = "absolute";
    stickyImage.style.bottom = "0"; 
    stickyImage.style.transform = "translateY(50%)"; 
    
    const rocketTimeline = gsap.timeline({
      paused: true,
      defaults: {
        ease: "power1.inOut"
      }
    });
    rocketTimeline.to(stickyImage, {
      rotation: 5,
      duration: 0.01
    }).to(stickyImage, {
      rotation: -5,
      duration: 0.01
    }).to(stickyImage, {
      rotation: 0,
      duration: 0.01
    });

    // --- Revamped timeline fill logic ---
    const setupScrollTrigger = () => {
      if (!smoother) {
        setTimeout(setupScrollTrigger, 100);
        return;
      }

      const timeline = document.getElementById("timeline");
      timelineHeight = timeline.offsetHeight;
      fillLine.style.position = "absolute";
      fillLine.style.bottom = "0";
      fillLine.style.height = "100%"; 

      ScrollTrigger.create({
        trigger: "#timeline",
        start: "top bottom", 
        end: "bottom top",
        onUpdate: self => {
          // Calculate progress so that at the bottom (page load), fill is 100%, and as you scroll up, fill shrinks to 0%
          const timelineRect = timeline.getBoundingClientRect();
          const viewportHeight = window.innerHeight;
          const timelineTop = timelineRect.top;
          const timelineBottom = timelineRect.bottom;
          const timelineHeight = timelineRect.height;

          // Progress: 1 at bottom (timeline bottom at viewport bottom), 0 at top (timeline top at viewport top)
          let progress;
          if (timelineBottom <= 0) {
            progress = 0;
          } else if (timelineTop >= viewportHeight) {
            progress = 1;
          } else {
            // Correct progress: 1 at bottom, 0 at top
            progress = (timelineBottom - viewportHeight) / (timelineHeight - viewportHeight);
            progress = Math.max(0, Math.min(1, progress));
          }
          // Set fill height (starts at 100%, shrinks to 0%)
          fillLine.style.height = (progress * 100) + "%";
          // Move rocket accordingly (optional, keep as before)
          const rocketBottom = progress * timelineHeight;
          gsap.to(stickyImage, {
            bottom: rocketBottom + "px",
            duration: 0.1,
            overwrite: "auto"
          });

          if (Math.abs(self.getVelocity()) > 0) {
            const intensity = Math.min(1, Math.abs(self.getVelocity()) / 1000);
            gsap.to(stickyImage, {
              scale: 1 + (intensity * 0.05),
              duration: 0.2
            });

            if (self.getVelocity() > 0) { 
              gsap.to(stickyImage, { rotation: 180, duration: 0.3 });
            } else {
              gsap.to(stickyImage, { rotation: 0, duration: 0.3 });
            }
          }
        },
        invalidateOnRefresh: true
      });
      
      document.querySelectorAll('.dot-label').forEach(label => {
        const dotPosition = parseFloat(label.style.bottom) || 0;
        gsap.fromTo(label, 
          { 
            opacity: 0, 
            x: -50,
            visibility: 'hidden'
          },
          {
            opacity: 1,
            x: 0,
            visibility: 'visible',
            duration: 1,
            ease: "power2.out",
            scrollTrigger: {
              trigger: label.previousElementSibling, // Use the timeline dot as trigger instead
              start: "center bottom",
              end: "center top-=150",
              toggleActions: "restart reverse restart reverse",
              markers: false
            }
          }
        );
      });
      document.querySelectorAll('.dot-image').forEach(label => {
        const dotPosition = parseFloat(label.style.bottom) || 0;
        gsap.fromTo(label, 
          { 
            opacity: 0, 
            x: -50,
            visibility: 'hidden'
          },
          {
            opacity: 1,
            x: 0,
            visibility: 'visible',
            duration: 1,
            ease: "power2.out",
            scrollTrigger: {
              trigger: label.previousElementSibling, // Use the timeline dot as trigger instead
              start: "center bottom",
              end: "center top-=150",
              toggleActions: "restart reverse restart reverse",
              markers: false
            }
          }
        );
      });
      // Initialize bottom labels to be visible on page load since we start at the bottom
      setTimeout(() => {
        const viewportHeight = window.innerHeight;
        document.querySelectorAll('.dot-label').forEach(label => {
          const bottom = parseFloat(label.style.bottom) || 0;
          if (bottom <= 20) {
            gsap.set(label, {opacity: 1, x: 0, visibility: 'visible'});
          }
        });
      }, 500);
    };

    const checkSmoother = () => {
      smoother = ScrollSmoother.get();
      if (smoother) {
        setupScrollTrigger();
      } else {
        setTimeout(checkSmoother, 100);
      }
    };

    checkSmoother();
  });
</script>